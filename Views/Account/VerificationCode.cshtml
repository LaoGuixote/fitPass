@{
	ViewData["Title"] = "帳號驗證";
	Layout = null;
}

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>FitPass - 註冊驗證</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>

<div class="container mt-5" style="max-width: 420px; text-align:center">
	<h1 class="fw-bold text-success mb-4" style="font-size: 38px;">FitPass</h1>
	<h2 class="text-center mb-4">驗證你的信箱</h2>
	<p class="text-muted text-center">我們已將驗證碼寄送至您的信箱。</p>

	<form asp-action="VerificationCode" method="post">
		<div class="mb-3">
			<input type="text" name="VerificationCode" id="VerificationCode" class="form-control" required placeholder="請輸入6位數驗證碼" maxlength="6">
		</div>
		<div class="d-grid">
			<button type="submit" class="btn btn-success">驗證</button>
			<br />
			<button id="resendBtn" class="btn btn-success">重新發送驗證碼</button>
		</div>
	</form>
	<div id="resendMsg"></div>
	@if (ViewBag.text != null)
	{
		<div class="alert alert-danger">@ViewBag.text</div>
	}
</div>

<script>
	document.getElementById('resendBtn').addEventListener('click', function () {
		this.disabled = true;
		let t = 10;
		let countdown = setInterval(() => {
			document.getElementById('resendBtn').innerText = `重新發送驗證碼(${t}) `;
			t -= 1;
			if (t < 0) {
				document.getElementById('resendBtn').disabled = false;
				document.getElementById('resendBtn').innerText = '重新發送驗證碼';
				clearInterval(countdown);
			}
		}, 1000);

		fetch('/Account/ResendCode', {
			method: 'POST',
			headers: { 'Content-Type': 'application/json' }
		})
		.then(res => res.json())
		.then(data => {
			const msg = document.getElementById('resendMsg');
			if (data.success) {
				msg.innerHTML = `<div class="alert alert-info mt-2">${data.message}</div>`;
			} else {
				msg.innerHTML = `<div class="alert alert-danger mt-2">寄送失敗，請稍後再試</div>`;
			}
		})
		.catch(() => {
			msg.innerHTML = `<div class="alert alert-danger mt-2">寄送失敗，請稍後再試</div>`;
		});
	});
</script>
